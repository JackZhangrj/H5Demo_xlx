<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>汇利伟业大数据平台</title>
    <script src="//libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/bgcanvas.css">
    <script type="text/javascript" src="../js/bgcanvas.js"></script>

    <script type="text/javascript" src="//webapi.amap.com/maps?v=1.4.14&key=35380e9ca7fbd13031eb6a6bb9021581&plugin=AMap.DistrictSearch"></script><!--高德地图-->
    <script src="../js/gdmap.js"></script>
    <script type="text/javascript" src="//webapi.amap.com/demos/js/liteToolbar.js"></script>
    <link rel="stylesheet" href="//a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"/>

    <script src="//echarts.baidu.com/build/dist/echarts-all.js"></script>
    <script type="text/javascript" src="//echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
    <script type="text/javascript" src="//echarts.baidu.com/gallery/vendors/echarts-gl/echarts-gl.min.js"></script>
    <script type="text/javascript" src="//echarts.baidu.com/gallery/vendors/echarts-stat/ecStat.min.js"></script>
    <script type="text/javascript" src="//echarts.baidu.com/gallery/vendors/echarts/extension/dataTool.min.js"></script>
    <script type="text/javascript" src="//echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>
    <script type="text/javascript" src="//echarts.baidu.com/gallery/vendors/echarts/map/js/world.js"></script>
    <script type="text/javascript" src="//api.map.baidu.com/api?v=2.0&ak=xfhhaTThl11qYVrqLZii6w8qE5ggnhrY&__ec_v__=20190126"></script>
    <script type="text/javascript" src="//echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>
    <script type="text/javascript" src="//echarts.baidu.com/gallery/vendors/simplex.js"></script>

    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.13.0/dist/av-live-query-min.js"></script>
    <script src="../js/leanclouddata.js"></script>
</head>
<body>
    <canvas width="2560" height="1440"></canvas>
<!--    <div style=" text-align:center;font-size: 100px; width: 100%; position: absolute;top:10%;" >
        <span style="color: white; font-family:SimHei;">汇利伟业大数据平台控制台</span>
    </div>-->

    <div style="width: 100%;height: 100%;color: white;"> <!--border:1px solid;-->
        <div style="width: 100%;height: 300px;"><!--border:1px solid;-->
            <div style="width: 100%;height: 80px">

            </div>
            <div style=" text-align:center;font-size: 100px; width: 100%;" >
                <span style="color: white; font-family:SimHei;margin-top: 100px;">汇利伟业大数据平台控制台</span>
            </div>
        </div>
        <div  style="width: 100%;height: 1500px;">
            <div style="width: 25%;float: left;">
                <div>
                    <div style="width: 100%;text-align:center;height: 80px;" >
                        <span style="font-size: 50px;width: 20%;height: 80px;">区域选择</span>
                    </div>
                    <br>
                    <div style="width: 100%; clear:both;">
                        <div style="width: 40%;float: left;text-align:right;" >
                            <span style="height: 50px;font-size: 40px">省市区</span>
                        </div>
                        <div style="width: 40%;float: left;" class="input-item ">
                            <select id='province' style="left: 20px;width:200px;height: 50px;" onchange='search(this)'></select>
                        </div>
                    </div>
                    <br>
                    <br>
                    <div style="width: 100%; clear:both;">
                        <div style="width: 40%;float: left;text-align:right;">
                            <span style="height: 50px;font-size: 40px">地级市</span>
                        </div>
                        <div style="width: 40%;float: left;" class="input-item">
                            <select id='city' style="left: 20px; width:200px;height: 50px;" onchange='search(this)'></select>
                        </div>
                    </div>
                    <br>
                    <br>
                    <div style="width: 100% ;clear:both;">
                        <div style="width: 40%;float: left;text-align:right">
                            <span style="height: 50px;font-size: 40px">区级县</span>
                        </div>
                        <div style="width: 40%;float: left;" class="input-item">
                            <select id='district' style="left: 20px;width:200px;height: 50px;" class="input-item-prepend" onchange='search(this)'></select>
                        </div>
                    </div>
                    <br>
                    <br>
                </div>
                <br>
                <div style="clear:both; ">
                    <div style="width: 100%;text-align:center;height: 80px;">
                        <span style="font-size: 50px;width: 20%;height: 80px;">区域信息</span>
                    </div>
                    <br>
                    <div style="width: 100%;height: 100%;text-align:center;font-size: 40px">
                        <p id="poptotaltext"></p>     <br>
                        <p id="areatotaltext"></p>     <br>
                        <p id="ploughtotaltext"></p>     <br>
                        <p id="fieldcropsdatatext"></p>     <br>
                        <p id="cashcropdatatext"></p>     <br>
                        <p id="dealerdatatext"></p>     <br>
                        <p id="shopkeeperdatatext"></p>     <br>
                        <p id="plantinglargedatatext"></p>     <br>
                    </div>
                </div>
            </div>
            <div id="container" style="width: 50%;float: left;height: 100%;">

            </div>
            <div style="width: 25%;float: left;">
                <div style="width: 100%;text-align:center;height: 80px;">
                    <span style="font-size: 50px;width: 20%;height: 80px;">服务及行业信息</span>
                </div>
                <br>
                <div style="width: 100%;text-align: center;font-size: 40px;">
                    <div style="width: 100%;height: 100%; text-align:center;bottom: 0px; font-size: 40px;overflow: hidden;">
                        <button style="position: relative; width: 30%;height: 80px; " onclick="">农化服务</button><br><br>
                    </div>
                    <div style="width: 100%;height: 100%; text-align:center;bottom: 0px; font-size: 40px;overflow: hidden;">
                        <button style="position: relative; width: 30%;height: 80px; " onclick="">行业资讯</button><br><br>
                    </div>
                    <div style="width: 100%;height: 100%; text-align:center;bottom: 0px; font-size: 40px;overflow: hidden;">
                        <button style="position: relative; width: 30%;height: 80px; " onclick="">农机宝典</button><br><br>
                    </div>
                </div>
                <br>
                <div style="width: 100%;text-align:center;height: 80px;">
                    <span style="font-size: 50px;width: 20%;height: 80px;">区域分析</span>
                </div>
                <br>
                <div style="width: 100%;text-align: center;font-size: 40px">
                    <p id="regionaltext"></p>
                </div>
                <br>
                <br>
                <div style="width: 100%;text-align:center;height: 80px;">
                    <span style="font-size: 50px;width: 20%;height: 80px;">指导建议</span>
                </div>
                <br>
                <div style="width: 100%;text-align: center;font-size: 40px;">
                    <p id="suggesttext"></p>
                    <p id="suggesttext_2"></p>
                </div>

            </div>
        </div>
        <div style="width: 100%;height: 25%;">
            <div style="width: 100%;height: 200px;">
                <div style="width: 100%;height: 100%; text-align:center;bottom: 0px; font-size: 40px;overflow: hidden;">
                    <button style="position: relative; width: 30%;height: 80px; " onclick="location.href='../xlxhtml/navigation.html'">返回</button><br><br>
                </div>
            </div>
            <div id="column_cs_1" style="width: 33.33%;height: 500px;float: left; ">

            </div>
            <div id="column_cs_2" style="width: 33.33%;height: 500px;float: left;">

            </div>
            <div id="column_cs_3" style="width: 33.33%;height: 500px;float: left;">

            </div>

        </div>
    </div>
</body>
<script>
    var poptotaltext = document.getElementById('poptotaltext');
    var areatotaltext = document.getElementById('areatotaltext');
    var ploughtotaltext = document.getElementById('ploughtotaltext');
    var fieldcropsdatatext = document.getElementById('fieldcropsdatatext');
    var cashcropdatatext = document.getElementById('cashcropdatatext');
    var dealerdatatext = document.getElementById('dealerdatatext');
    var shopkeeperdatatext = document.getElementById('shopkeeperdatatext');
    var plantinglargedatatext = document.getElementById('plantinglargedatatext');

    var regionaltext = document.getElementById('regionaltext');
    var suggesttext = document.getElementById('suggesttext');
    var suggesttext_2 = document.getElementById('suggesttext_2');

    window.onload=function()
    {
        starttextdata();
        setoption1(100,100,100);
        setoption2(100,100);
        setoption3(100,80,50);
    }

    function starttextdata()
    {
        poptotaltext.innerHTML="总人口(万)：暂无数据";
        areatotaltext.innerHTML="总面积(公里)：暂无数据";
        ploughtotaltext.innerHTML="耕地面积(万亩)：暂无数据";
        fieldcropsdatatext.innerHTML="大田作物(万吨)：暂无数据";
        cashcropdatatext.innerHTML="经济作物(万吨)：暂无数据";
        dealerdatatext.innerHTML="经销商数量(个)：暂无数据";
        shopkeeperdatatext.innerHTML="零售商数量(个)：暂无数据";
        plantinglargedatatext.innerHTML="种植大户数量(个)：暂无数据";
        regionaltext.innerHTML="暂无";
        suggesttext.innerHTML="暂无";
        suggesttext_2.innerHTML="";
    }

/*    var Todo = AV.Object.extend('Todo');
    var Query=new AV.Query("Todo");*/

    function settextdata(district) {
        // 新建一个 Todo 对象
        console.log(district);
        Query.equalTo('district', district);

        Query.find().then(function(results) {
            // 返回一个符合条件的 list
            if(results.length!=0)
            {
                console.log("数据库中有该数据");
                var obj = results[0];
                console.log(obj.attributes);
                poptotaltext.innerHTML="总人口(万)："+obj.get("poptotal");
                areatotaltext.innerHTML="总面积(公里)："+obj.get("areatotal");
                ploughtotaltext.innerHTML="耕地面积(万亩)："+obj.get("ploughtotal");
                fieldcropsdatatext.innerHTML="大田作物(万吨)："+obj.get("fieldcropsdata");
                cashcropdatatext.innerHTML="经济作物(万吨)："+obj.get("cashcropdata");
                dealerdatatext.innerHTML="经销商数量(个)："+obj.get("dealerdata");
                shopkeeperdatatext.innerHTML="零售商数量(个)："+obj.get("shopkeeperdata");
                plantinglargedatatext.innerHTML="种植大户数量(个)："+obj.get("plantinglargedata");
                regionaltext.innerHTML=district +"耕地面积占总面积:"+Math.ceil(parseInt(obj.get("ploughtotal"))/parseInt(obj.get("areatotal"))*100)+"%";
                var math_1=(obj.get("shopkeeperdata")/obj.get("dealerdata")).toFixed(2);
                var math_text= math_1>1?"小":"大";
                suggesttext.innerHTML="本地区经销商：零售商 = 1："+math_1;
                suggesttext_2.innerHTML="市场潜力："+math_text;
                setoption1(obj.get("dealerdata"),obj.get("shopkeeperdata"),obj.get("plantinglargedata"));
                setoption2(obj.get("fieldcropsdata"),obj.get("cashcropdata"));
                setoption3(obj.get("areatotal"),obj.get("ploughtotal"),obj.get("poptotal"));
            }
            else
            {
                starttextdata();
                console.log("数据库中无该数据");
                setoption1(100,100,100);
                setoption2(100,100);
                setoption3(100,80,50);
            }
        }).catch(function(error) {
            // catch 方法写在 Promise 链式的最后，可以捕捉到全部 error
            console.log(error);
        });
    }
</script>

<script type="text/javascript">
    var map, district, polygons = [], citycode;
    var citySelect = document.getElementById('city');
    var districtSelect = document.getElementById('district');
/*    var areaSelect = document.getElementById('street');*/

    map = new AMap.Map('container', {
        resizeEnable: true,
        center: [116.30946, 39.937629],
        zoom: 3,
        mapStyle: 'amap://styles/darkblue',
    });
    //行政区划查询
    var opts = {
        subdistrict: 1,   //返回下一级行政区
        showbiz:false  //最后一级返回街道信息
    };
    district = new AMap.DistrictSearch(opts);//注意：需要使用插件同步下发功能才能这样直接使用
    district.search('中国', function(status, result) {
        if(status=='complete'){
            getData(result.districtList[0]);
        }
    });
    function getData(data,level,objtext) {
        var bounds = data.boundaries;
        if (bounds) {
            for (var i = 0, l = bounds.length; i < l; i++) {
                var polygon = new AMap.Polygon({
                    map: map,
                    strokeWeight: 1,
                    strokeColor: '#0091ea',
                    fillColor: '#80d8ff',
                    fillOpacity: 0.2,
                    path: bounds[i]
                });
                polygons.push(polygon);
            }
            map.setFitView();//地图自适应
        }

        //清空下一级别的下拉列表
        if (level === 'province') {
            citySelect.innerHTML = '';
            districtSelect.innerHTML = '';
/*            areaSelect.innerHTML = '';*/
        } else if (level === 'city') {
            districtSelect.innerHTML = '';
/*            areaSelect.innerHTML = '';*/
        } else if (level === 'district') {
            settextdata(objtext);
/*            areaSelect.innerHTML = '';*/
        }

        try {
            var subList = data.districtList;
            if (subList) {
                var contentSub = new Option('--请选择--');
                var curlevel = subList[0].level;
                var curList = document.querySelector('#' + curlevel);
                curList.add(contentSub);
                for (var i = 0, l = subList.length; i < l; i++) {
                    var name = subList[i].name;
                    var levelSub = subList[i].level;
                    var cityCode = subList[i].citycode;
                    contentSub = new Option(name);
                    contentSub.setAttribute("value", levelSub);
                    contentSub.center = subList[i].center;
                    contentSub.adcode = subList[i].adcode;
                    curList.add(contentSub);
                }
            }
        }catch (e) {
            console.log(e.message);
        }
    }
    function search(obj) {
        //清除地图上所有覆盖物
        for (var i = 0, l = polygons.length; i < l; i++) {
            polygons[i].setMap(null);
        }
        var option = obj[obj.options.selectedIndex];
        var keyword = option.text; //关键字
        var adcode = option.adcode;
        district.setLevel(option.value); //行政区级别
        district.setExtensions('all');
        //行政区查询
        //按照adcode进行查询可以保证数据返回的唯一性
        district.search(adcode, function(status, result) {
            if(status === 'complete'){
                getData(result.districtList[0],obj.id,option.text);
            }
        });
    }
    function setCenter(obj){
        map.setCenter(obj[obj.options.selectedIndex].center)
    }
</script>
<script type="text/javascript">
    // 基于准备好的dom，初始化echarts实例
    var myChart_1 = echarts.init(document.getElementById('column_cs_1'));
    var myChart_2 = echarts.init(document.getElementById('column_cs_2'));
    var myChart_3 = echarts.init(document.getElementById('column_cs_3'));

    function setoption1(option_1_value1data,option_1_value2data,option_1_value3data)
    {
        option_1 = {
            backgroundColor:null,//2c343c

            title: {
                text: '区域信息',
                left: 'center',
                size: 50,
                top: 20,
                textStyle: {
                    color: '#ffffff'
                }
            },

            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },

            visualMap: {
                show: false,
                min: 80,
                max: 600,
                inRange: {
                    colorLightness: [0, 1]
                }
            },
            series : [
                {
                    name:'区域信息',
                    type:'pie',
                    radius : '55%',
                    center: ['50%', '50%'],
                    data:[
                        {value:option_1_value1data, name:'经销商数据'},
                        {value:option_1_value2data, name:'零售商数据'},
                        {value:option_1_value3data, name:'种植大户数据'},
                    ].sort(function (a, b) { return a.value - b.value; }),
                    roseType: 'radius',
                    label: {
                        normal: {
                            textStyle: {
                                color: 'rgba(255, 255, 255, 0.3)'
                            }
                        }
                    },
                    labelLine: {
                        normal: {
                            lineStyle: {
                                color: 'rgba(255, 255, 255, 0.3)'
                            },
                            smooth: 0.2,
                            length: 10,
                            length2: 20
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: '#c23531',
                            shadowBlur: 200,
                            shadowColor: 'rgba(255,255,255,0.5)'
                        }
                    },

                    animationType: 'scale',
                    animationEasing: 'elasticOut',
                    animationDelay: function (idx) {
                        return Math.random() * 200;
                    }
                }
            ]
        };
        myChart_1.setOption(option_1);
    }

    function setoption2(option_2_value1data,option_2_value2data)
    {
        option_2 = {
            color: ['#3398DB'],
            tooltip : {
                trigger: 'axis',
                axisPointer : {            // 坐标轴指示器，坐标轴触发有效
                    type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                }
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis : [
                {
                    type : 'category',
                    data : ['大田作物', '经济作物'],
                    axisTick: {
                        alignWithLabel: true
                    }
                }
            ],
            yAxis : [
                {
                    type : 'value'
                }
            ],
            series : [
                {
                    name:'(万吨)',
                    type:'bar',
                    barWidth: '60%',
                    data:[option_2_value1data, option_2_value2data]
                }
            ]
        };
        myChart_2.setOption(option_2);
    }

    function setoption3(option_3_value1data,option_3_value2data,option_3_value3data)
    {
        option_3 = {
            title: {
                text: '区域信息漏斗图',
                subtext: '区域信息'
            },
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c}%"
            },
            toolbox: {
                feature: {
                    dataView: {readOnly: false},
                    restore: {},
                    saveAsImage: {}
                }
            },
            legend: {
                data: ['总面积','耕地面积','总人口']
            },
            calculable: true,
            series: [
                {
                    name:'区域信息',
                    type:'funnel',
                    left: '10%',
                    top: 60,
                    //x2: 80,
                    bottom: 60,
                    width: '80%',
                    // height: {totalHeight} - y - y2,
                    min: 0,
                    max: 100,
                    minSize: '0%',
                    maxSize: '100%',
                    sort: 'descending',
                    gap: 2,
                    label: {
                        show: true,
                        position: 'inside'
                    },
                    labelLine: {
                        length: 10,
                        lineStyle: {
                            width: 1,
                            type: 'solid'
                        }
                    },
                    itemStyle: {
                        borderColor: '#fff',
                        borderWidth: 1
                    },
                    emphasis: {
                        label: {
                            fontSize: 20
                        }
                    },
                    data: [
                        {value: option_3_value1data, name: '总面积'},
                        {value: option_3_value2data, name: '耕地面积'},
                        {value: option_3_value3data, name: '总人口'},
                    ]
                }
            ]
        };
        myChart_3.setOption(option_3);
    }




</script>
</html>